{% extends "base.html" %}
{% block title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ â€¢ {{ full_name }}{% endblock %}

{% block content %}
<section class="member-details-section">
    <div class="container">
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ + Ø§Ù„ÙƒÙˆØ¯ + Ø§Ù„Ù„Ù‚Ø¨ + Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="member-header text-center">
            <h1 class="member-names">{{ full_name }}</h1>
            <p class="member-code">
                <span class="code-badge">{{ member.code }}</span>
            </p>

            {% if member.nick_name %}
            <div class="nickname-display">
                <span class="nickname-big">{{ member.nick_name }}</span>
            </div>
            {% endif %}

            {% if info.status %}
            <div class="status-display">
                {% if info.status in ["Ù…ØªÙˆÙÙŠ", "Ù…ØªÙˆÙÙŠØ©"] %}
                <span class="status deceased">Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡ â€¢ {{ info.status }}</span>
                {% else %}
                <span class="status alive">{{ info.status }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <div class="member-body">
            <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© -->
            {% if picture_url %}
            <div class="profile-picture">
                <img src="/{{ picture_url }}" alt="{{ full_name }}" class="profile-img">
                <p class="img-caption">ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø¶Ùˆ</p>
            </div>
            {% endif %}

            <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
            <div class="info-section">
                <h2 class="section-title">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
                <div class="info-grid">
                    {% macro info_row(label, value, link=False) %}
                        {% if value %}
                        <div class="info-row">
                            <span class="info-label">{{ label }}</span>
                            <span class="info-value">
                                {% if link %}
                                <a href="{{ link }}{{ value }}">{{ value }}</a>
                                {% else %}
                                {{ value }}
                                {% endif %}
                            </span>
                        </div>
                        {% endif %}
                    {% endmacro %}

                    {{ info_row("Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©", member.relation) }}
                    {{ info_row("Ø§Ù„Ø¬Ù†Ø³", gender) }}
                    {{ info_row("Ø§Ù„Ù…Ø³ØªÙˆÙ‰", member.level) }}
                    {{ info_row("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯", info.d_o_b) }}
                    {{ info_row("ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø©", info.d_o_d) }}
                    {% if age_details %}
                    
                    {# 1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙÙŠÙ‹Ø§ (Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙØ§Ø© ÙˆØ§Ù„ÙˆÙØ§Ø© Ù…Ù†Ø°) #}
                    {% if age_details.has_dod %}
                        {# ğŸ’¡ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ØµØ­ÙŠØ­: ÙŠØ³ØªØ®Ø¯Ù… Ù‚ÙŠÙ…Ø© age_at_death Ø§Ù„ØªÙŠ Ø¬Ù„Ø¨Ù‡Ø§ Ø§Ù„Ù€ Router Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª #}
                        {{ info_row("Ø§Ù„Ø¹Ù…Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙØ§Ø©", age_details.age_at_death ~ " Ø³Ù†Ø©") if age_details.age_at_death is not none else "" }}
                        {{ info_row("Ø§Ù„ÙˆÙØ§Ø© Ù…Ù†Ø°", age_details.time_since_death) if age_details.time_since_death is not none else "" }}

                    {# 2. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø© (Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ) #}
                    {% elif age_details.has_dob %}
                        {{ info_row("Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ", age_details.age ~ " Ø³Ù†Ø©") if age_details.age is not none else "" }}
                    {% endif %}

                    {% endif %}
                    {{ info_row("Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯", info.p_o_b) }}
                    {{ info_row("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", info.address) }}
                    {{ info_row("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", info.email, "mailto:") }}
                    {{ info_row("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", info.phone, "tel:") }}
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø±ÙŠØ© -->
            <div class="relations-section">
                <h2 class="section-title">Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø±ÙŠØ©</h2>
                <div class="relations-grid">

                    <!-- Ø§Ù„Ø£Ù… -->
                    <div class="relation-card mother">
                        <h5>Ø§Ù„Ø£Ù…</h5>
                        {% if mother_full_name %}
                        <a href="/names/details/{{ member.m_code }}" class="relation-link">{{ mother_full_name }}</a>
                        {% else %}
                        <span class="text-muted">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©</span>
                        {% endif %}
                    </div>

                    <!-- Ø§Ù„Ø²ÙˆØ¬/Ø§Ù„Ø²ÙˆØ¬Ø© -->
                    {% if gender == "Ø°ÙƒØ±" and wives %}
                    <div class="relation-card wife">
                        <h5>Ø§Ù„Ø²ÙˆØ¬Ø§Øª ({{ wives|length }})</h5>
                        {% for wife in wives %}
                        <a href="/names/details/{{ wife.code }}" class="relation-link">
                            {{ wife.name }}{% if loop.length > 1 %} ({{ loop.index }}){% endif %}
                        </a>
                        {% endfor %}
                    </div>
                    {% elif gender == "Ø£Ù†Ø«Ù‰" and husbands %}
                    <div class="relation-card husband">
                        <h5>Ø§Ù„Ø²ÙˆØ¬</h5>
                        {% for h in husbands %}
                        <a href="/names/details/{{ h.code }}" class="relation-link">{{ h.name }}</a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="relation-card spouse">
                        <h5>Ø§Ù„Ø²ÙˆØ¬ / Ø§Ù„Ø²ÙˆØ¬Ø©</h5>
                        <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                    </div>
                    {% endif %}

                    <!-- Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ -->
                    <div class="relation-card children">
                        <h5>Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ({{ children|length }})</h5>
                        <div class="children-list">
                            {% if children %}
                                {% for child in children %}
                                <a href="/names/details/{{ child.code }}" class="child-item">
                                    {{ child.name }}
                                </a>
                                {% endfor %}
                            {% else %}
                            <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¨Ù†Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙˆÙ†</span>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ© -->
        <div class="action-buttons">
            {% if user.role == "admin"%}
            <a href="/names/edit/{{ member.code }}" class="btn-edit">
                ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </a>
            {% endif %}
            <a href="/names" class="btn-back">
                Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
            </a>
        </div>
    </div>
</section>
{% endblock %}