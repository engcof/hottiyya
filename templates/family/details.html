{% extends "base.html" %}
{% block title %}تفاصيل العضو • {{ full_name }}{% endblock %}

{% block content %}
<section class="member-details-section">
    <div class="container">
        <!-- العنوان الرئيسي + الكود + اللقب + الحالة -->
        <div class="member-header text-center">
            <h1 class="member-names">{{ full_name }}</h1>
            <p class="member-code">
                <span class="code-badge">{{ member.code }}</span>
            </p>

            {% if member.nick_name %}
            <div class="nickname-display">
                <span class="nickname-big">{{ member.nick_name }}</span>
            </div>
            {% endif %}

            {% if info.status %}
            <div class="status-display">
                {% if info.status in ["متوفي", "متوفية"] %}
                <span class="status deceased">رحمه الله • {{ info.status }}</span>
                {% else %}
                <span class="status alive">{{ info.status }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <div class="member-body">
            <!-- الصورة الشخصية -->
            {% if picture_url %}
            <div class="profile-picture">
                <img src="/{{ picture_url }}" alt="{{ full_name }}" class="profile-img">
                <p class="img-caption">صورة العضو</p>
            </div>
            {% endif %}

            <!-- المعلومات الأساسية -->
            <div class="info-section">
                <h2 class="section-title">المعلومات الأساسية</h2>
                <div class="info-grid">
                    {% macro info_row(label, value, link=False) %}
                        {% if value %}
                        <div class="info-row">
                            <span class="info-label">{{ label }}</span>
                            <span class="info-value">
                                {% if link %}
                                <a href="{{ link }}{{ value }}">{{ value }}</a>
                                {% else %}
                                {{ value }}
                                {% endif %}
                            </span>
                        </div>
                        {% endif %}
                    {% endmacro %}

                    {{ info_row("العلاقة", member.relation) }}
                    {{ info_row("الجنس", gender) }}
                    {{ info_row("المستوى", member.level) }}
                    {{ info_row("تاريخ الميلاد", info.d_o_b) }}
                    {{ info_row("تاريخ الوفاة", info.d_o_d) }}
                    {{ info_row("مكان الميلاد", info.p_o_b) }}
                    {{ info_row("العنوان", info.address) }}
                    {{ info_row("البريد الإلكتروني", info.email, "mailto:") }}
                    {{ info_row("رقم الهاتف", info.phone, "tel:") }}
                </div>
            </div>

            <!-- العلاقات الأسرية -->
            <div class="relations-section">
                <h2 class="section-title">العلاقات الأسرية</h2>
                <div class="relations-grid">

                    <!-- الأم -->
                    <div class="relation-card mother">
                        <h5>الأم</h5>
                        {% if mother_full_name %}
                        <a href="/names/details/{{ member.m_code }}" class="relation-link">{{ mother_full_name }}</a>
                        {% else %}
                        <span class="text-muted">غير معروفة</span>
                        {% endif %}
                    </div>

                    <!-- الزوج/الزوجة -->
                    {% if gender == "ذكر" and wives %}
                    <div class="relation-card wife">
                        <h5>الزوجات ({{ wives|length }})</h5>
                        {% for wife in wives %}
                        <a href="/names/details/{{ wife.code }}" class="relation-link">
                            {{ wife.name }}{% if loop.length > 1 %} ({{ loop.index }}){% endif %}
                        </a>
                        {% endfor %}
                    </div>
                    {% elif gender == "أنثى" and husbands %}
                    <div class="relation-card husband">
                        <h5>الزوج</h5>
                        {% for h in husbands %}
                        <a href="/names/details/{{ h.code }}" class="relation-link">{{ h.name }}</a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="relation-card spouse">
                        <h5>الزوج / الزوجة</h5>
                        <span class="text-muted">لا يوجد</span>
                    </div>
                    {% endif %}

                    <!-- الأبناء -->
                    <div class="relation-card children">
                        <h5>الأبناء ({{ children|length }})</h5>
                        <div class="children-list">
                            {% if children %}
                                {% for child in children %}
                                <a href="/names/details/{{ child.code }}" class="child-item">
                                    {{ child.name }}
                                </a>
                                {% endfor %}
                            {% else %}
                            <span class="text-muted">لا يوجد أبناء مسجلون</span>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- الأزرار السفلية -->
        <div class="action-buttons">
            {% if user.role == "admin"%}
            <a href="/names/edit/{{ member.code }}" class="btn-edit">
                تعديل البيانات
            </a>
            {% endif %}
            <a href="/names" class="btn-back">
                رجوع إلى شجرة العائلة
            </a>
        </div>
    </div>
</section>
{% endblock %}