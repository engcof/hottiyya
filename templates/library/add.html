{% extends "base.html" %}
{% block title %}إضافة كتاب جديد{% endblock %}
{% block content %}
<div class="add-book-container">
    <div class="form-card">
        <div id="overlay">
            <div class="spinner"></div>
            <p style="margin-top: 20px; color: #2d3748; font-weight: bold;">جاري معالجة الكتاب ورفعه... يرجى الانتظار</p>
        </div>
        <div class="form-header">
            <h2>إضافة كتاب للمكتبة</h2>
            <p style="color: #718096;">شارك المعرفة مع العالم</p>
        </div>

        {% if error %}
        <div class="error-msg">
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
        </div>
        {% endif %}

        <form action="/library/add" method="POST" enctype="multipart/form-data" id="uploadForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

            <div class="form-group">
                <label>اسم الكتاب *</label>
                <input type="text" name="title" class="custom-input" placeholder="مثال: مقدمة ابن خلدون" required value="{{ title if title else '' }}">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>اسم المؤلف</label>
                    <input type="text" name="author" class="custom-input" placeholder="اسم الكاتب" value="{{ author if author else '' }}">
                </div>
                <div class="form-group">
                    <label>تصنيف الكتاب *</label>
                    <select name="category" class="custom-select" required>
                        {% for cat in categories %}
                        <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group" style="background: #f0fff4; padding: 15px; border-radius: 12px; border: 1px solid #c6f6d5; margin-bottom: 25px;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <label style="margin-bottom: 0; color: #27ae60;">
                            <i class="fas fa-check-circle"></i> إتاحة الكتاب للتحميل المباشر
                        </label>
                        <small style="color: #52735e; display: block;">يمكنك دائماً تغيير هذا الخيار لاحقاً من صفحة التعديل.</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" name="allow_download" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label>ملف الكتاب (PDF / Word) *</label>
                <div class="file-input-wrapper">
                    <input type="file" name="book_file" accept=".pdf,.doc,.docx" required style="width: 100%;">
                    <p style="font-size: 0.8rem; color: #a0aec0; margin-top: 8px;">الحد الأقصى للملف 40 ميجابايت</p>
                </div>
            </div>

            <div class="form-group">
                <label>صورة الغلاف (اختياري)</label>
                <input type="file" name="cover_image" class="custom-input" accept="image/*">
            </div>

            <button type="submit" class="submit-btn">
                <i class="fas fa-cloud-upload-alt"></i> رفع الكتاب الآن
            </button>
            
            <a href="/library" class="cancel-link">إلغاء والعودة للمكتبة</a>
        </form>
    </div>
</div>
<script>
    document.getElementById('uploadForm').onsubmit = function() {
        // إظهار الشاشة
        document.getElementById('overlay').style.display = 'flex';
        // تغيير النص ليكون متوافقاً مع الرفع السريع
        const statusText = document.querySelector('#overlay p');
        statusText.innerHTML = "جاري تحضير الكتاب... سيتم تحويلك للمكتبة خلال لحظات";
    };
</script>

{% endblock %}