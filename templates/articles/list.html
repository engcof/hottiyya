{% extends "base.html" %}
{% block title %}المقالات{% endblock %}

{% block content %}

<section class="articles-section">
    <div class="container">
        <!-- العنوان + زر كتابة مقال -->
        <div class="section-header">
            <h1 class="page-title">المقالات</h1>
            {% if can_add %}
            <a href="/articles/add" class="btn-add">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                كتابة مقال جديد
            </a>
            {% endif %}
        </div>

        <!-- حالة عدم وجود مقالات -->
        {% if not articles %}
        <div class="empty-state glass">
            <div class="empty-icon">
                <svg viewBox="0 0 24 24" width="80" height="80">
                    <path fill="#94a3b8" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
                    <path fill="#64748b" d="M9 13h6v2H9zm0 4h6v2H9z"/>
                </svg>
            </div>
            <h3>لا توجد مقالات بعد</h3>
            <p>كن أول من يشارك قصة أو خبر أو فكرة مع العائلة</p>
            {% if can_add %}
            <a href="/articles/add" class="btn-primary large">ابدأ الكتابة الآن</a>
            {% endif %}
        </div>
        {% else %}

        <!-- قائمة المقالات كبطاقات أنيقة -->
        <div class="articles-grid">
            {% for a in articles %}
            <article class="article-card glass">
                <div class="article-header">
                    <h2 class="article-title">
                        <a href="/articles/{{ a.id }}">{{ a.title }}</a>
                    </h2>
                    <div class="article-meta">
                        <span class="author">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                            {{ a.username }}
                        </span>
                        <span class="date">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/>
                            </svg>
                            {{ a.created_at.strftime('%d/%m/%Y') }}
                        </span>
                    </div>
                </div>

                <div class="article-excerpt">
                    {{ a.content|striptags|truncate(180) }}
                    {% if a.content|length > 180 %}...{% endif %}
                </div>

                <div class="article-footer">
                    <div class="comments-count">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/>
                        </svg>
                        <span>
                            {% if a.comments_count > 0 %}
                            {{ a.comments_count }} تعليق
                            {% else %}
                            لا توجد تعليقات
                            {% endif %}
                        </span>
                    </div>
                    <a href="/articles/{{ a.id }}" class="read-more">
                        اقرأ المقال
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                        </svg>
                    </a>
                </div>
            </article>
            {% endfor %}
        </div>

        <!-- ترقيم الصفحات -->
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if has_prev %}
            <a href="/articles?page={{ page - 1 }}" class="page-btn">السابق</a>
            {% endif %}
            <span class="page-info">صفحة {{ page }} من {{ total_pages }}</span>
            {% if has_next %}
            <a href="/articles?page={{ page + 1 }}" class="page-btn">التالي</a>
            {% endif %}
        </div>
        {% endif %}

        {% endif %}
    </div>
</section>
{% endblock %}