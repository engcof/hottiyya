{% extends "base.html" %}

{% block content %}
<main class="container">
    <div class="row justify-content-center" style="margin-top: 40px;">
        <div class="col-md-8 col-lg-6">
            <div class="glass-strong p-4 p-md-5">
                <div class="text-center mb-4">
                    <h2 class="form-title" style="font-size: 2rem;">
                        <i class="fas fa-cloud-upload-alt text-accent me-2"></i>إضافة فيديو جديد
                    </h2>
                    <p class="form-subtitle">شارك لحظات مميزة في المعرض الرقمي</p>
                </div>

                <form action="/video/add" method="POST" enctype="multipart/form-data" class="member-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                    <div class="form-group mb-4">
                        <label for="title">عنوان الفيديو <span class="required">*</span></label>
                        <input type="text" id="title" name="title" placeholder="مثال: اجتماع العيد " required minlength="3">
                        <small class="text-muted mt-1" style="font-size: 0.8rem;">يجب أن يكون العنوان معبراً وغير مكرر.</small>
                    </div>

                    <div class="form-group">
                        <label for="category">التصنيف <span class="required">*</span></label>
                        <select id="category" name="category" required>
                            <option value="" disabled selected>اختر التصنيف المناسب...</option>
                            <option value="اجتماعات العائلة">اجتماعات</option>
                            <option value="مناسبات وأفراح">مناسبات وأفراح</option>
                            <option value="تراث وقصص">تراث وقصص</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>

                    <div class="form-group mb-4">
                        <label for="video_file">ملف الفيديو <span class="required">*</span></label>
                        <input type="file" id="video_file" name="video_file" class="file-input" accept="video/mp4,video/x-m4v,video/*" required>
                        <div class="p-2 mt-2" style="background: rgba(239, 68, 68, 0.05); border-radius: 8px; border-right: 3px solid var(--danger);">
                            <small class="text-danger fw-bold">تنبيه: يفضل ألا يتجاوز الحجم 20 ميجابايت لضمان سرعة الرفع.</small>
                        </div>
                    </div>

                    <div class="d-grid gap-3 mt-5">
                        <button type="submit" class="cta-button w-100 border-0 py-3" id="uploadBtn">
                            <i class="fas fa-upload me-2"></i> بدء رفع الفيديو
                        </button>
                        <a href="/video/" class="text-center text-decoration-none py-2" style="color: var(--text-light); font-weight: 500;">
                            <i class="fas fa-arrow-right me-1"></i> إلغاء والعودة للمعرض
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<script>
    document.querySelector('form').onsubmit = function() {
        const btn = document.getElementById('uploadBtn');
        const titleInput = document.getElementById('title');
        
        // منع الضغط المتكرر وتغيير حالة الزر
        btn.disabled = true;
        btn.style.opacity = '0.7';
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> جاري الرفع إلى السحابة... يرجى الانتظار';
        
        // تسجيل العملية في الكونسول للتصحيح
        console.log("Starting upload for: " + titleInput.value);
    };
</script>
{% endblock %}